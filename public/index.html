

<html lang="pt">
<head>
  <meta charset="utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Em desenvolvimento APENAS -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' https://newsapi.org ws://localhost:*; img-src 'self' https: data:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">


  <title>Noticias APP</title>

  <style>
    html{background-color: aliceblue;}
    #formulario{width:600px;height:300px; background-color: aliceblue;}
    body { font-family: system-ui, sans-serif; margin: 2rem; width:600px;margin:auto;}
    form { display: grid; gap: .5rem; max-width: 280px; margin-right:20px;float:left}
    .results { display: grid; gap: 1rem; margin-top: 1.5rem;width: 600px; }
    article { max-width: 580px;border: 1px solid #ddd; padding: 1rem; border-radius: .5rem;background-color: white; }
    img { max-width: 580px; height: auto; border-radius: .25rem; }
    .meta { font-size: .875rem; color: #555; }
    #logo{height: 100px;}
    header{
      background-color: white;
      color:#1a73e7;
      text-shadow: 1px 1px white;
    }
    h1{float:left}
    #toTop{
      height: 50px;
      width: 50px;
      border-radius: 15px;
      color:white;
      background-color: #333;

      position: fixed;
      bottom:25px;
      right: 25px;

      text-decoration: none;
      font-size: x-large;
      font-weight: bolder;
    }
    #toTop:hover{
      background-color: #1a73e7;
    }

    html{
      scroll-behavior: smooth;
    }

    @media (max-width: 768px) {
      form { display: grid; gap: .5rem; width: 100%;zoom:1.2;float:left}
      #formulario{width:100%; background-color: aliceblue;}
      body { font-family: system-ui, sans-serif; margin: 2rem; width:90%;margin:auto;}
      .results { display: grid; gap: 1rem; margin-top: 1.5rem;width: 100%; }
     article img{width:100%;}
     button{width: 100%; height: 40px;border-radius: 10px;background-color: #1a73e7;color:white;text-shadow: #333 1px 1px;}
    }
  </style>
</head>
<body>
  <a id="totop" href="#">↑Top</a>
<header>
  <h1>Notícias APP</h1>
</header>

<div id="formulario">
  <form id="searchForm">
      <h2>Pesquisar notícias</h2>
    <label>
      Termo (q):
      <input type="text" name="q" placeholder="ex.: Apple OR Microsoft" required />
    </label>
    <label>
      Idioma (language):
      <select name="language">
        <option value="">(todos)</option>
        <option value="pt">pt</option>
        <option value="en">en</option>
        <option value="es">es</option>
        <option value="fr">fr</option>
      </select>
    </label>
    <label>
      Ordenação (sortBy):
      <select name="sortBy">
        <option value="publishedAt">publishedAt (recentes)</option>
        <option value="relevancy">relevancy</option>
        <option value="popularity">popularity</option>
      </select>
    </label>
    <label>
      De (from):
      <input type="date" name="from" />
    </label>
    <label>
      Até (to):
      <input type="date" name="to" />
    </label>
    <button type="submit">Pesquisar (everything)</button>
  </form>



  <form id="headlinesForm">
    <h2>Top headlines</h2>
    <label>
      País (country):
      <input type="text" name="country" placeholder="ex.: us, gb, de" />
    </label>
    <label>
      Categoria (category):
      <select name="category">
        <option value="">(todas)</option>
        <option>business</option>
        <option>entertainment</option>
        <option>general</option>
        <option>health</option>
        <option>science</option>
        <option>sports</option>
        <option>technology</option>
      </select>
    </label>
    <label>
      Palavras-chave (keywords):
      <input type="text" name="q" placeholder="ex.: trump, football" />
    </label>
    <button type="submit">Obter Top Headlines</button>
  </form>
</div>

  <div class="results" id="results"></div>

  <script>
    const resultsEl = document.getElementById('results');

    function renderArticles(data, title) {
      resultsEl.innerHTML = '';
      const h = document.createElement('h2');
      h.textContent = `${title} — ${data.totalResults ?? 0} resultado(s)`;
      resultsEl.appendChild(h);

      if (data.status !== 'ok') {
        const err = document.createElement('p');
        err.textContent = `Erro: ${data.code || ''} ${data.message || ''}`;
        resultsEl.appendChild(err);
        return;
      }

      data.articles.slice(0, 6).forEach(a => {

        const card = document.createElement('article');

        const h3 = document.createElement('h3');
        h3.textContent = a.title || '(sem título)';

        const meta = document.createElement('div');
        const src = a.source?.name ? ` • ${a.source.name}` : '';
        const pub = a.publishedAt ? new Date(a.publishedAt).toLocaleString() : '';
        meta.className = 'meta';
        meta.textContent = `${pub}${src}`;

        const desc = document.createElement('p');
        desc.textContent = a.description || '';

        if (a.urlToImage) {
          const img = document.createElement('img');
          img.src = a.urlToImage;
          img.alt = a.title || '';
          card.appendChild(img);
        }

        const link = document.createElement('a');
        link.href = a.url;
        link.target = '_blank';
        link.rel = 'noopener';
        link.textContent = 'Ler artigo →';

        card.appendChild(h3);
        card.appendChild(meta);
        card.appendChild(desc);
        card.appendChild(link);
        resultsEl.appendChild(card);
      });
    }

    // Form "everything"
    document.getElementById('searchForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = new FormData(e.currentTarget);
      const params = new URLSearchParams(Object.fromEntries(data.entries()));

      const r = await fetch(`/api/everything?${params.toString()}`);
      const json = await r.json();
      renderArticles(json, 'Resultados (everything)');
    });

    // Form "top-headlines"
    document.getElementById('headlinesForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = new FormData(e.currentTarget);
      const params = new URLSearchParams(Object.fromEntries(data.entries()));

      const r = await fetch(`/api/top-headlines?${params.toString()}`);
      const json = await r.json();
      renderArticles(json, 'Top Headlines');
    });
  </script>
</body>
</html>

